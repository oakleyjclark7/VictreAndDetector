## VictreAndDetector

An adapted version of the `Detector` Geant4 application, extended to simulate a **VICTRE digital breast phantom** in front of the HEXITEC detector. It builds upon Geant4's `exampleB1` and retains the same general simulation structure, but with a voxelised phantom volume.

This project is **highly specific to Chapter 7** of my PhD thesis. In particular, the method used to assign material densities to the phantom is tailored to that work. However, the phantom import framework may be adapted for other use cases.

---

## Contact

For questions or support, contact:  
**oakley.clark98@gmail.com**

---

## Build Instructions

- Requires **Geant4 version 10.7.0** (tested only with this version)  
- Tested on **Linux Ubuntu 20.04.6 LTS** only  

### Setup environment variables

```bash
cd /path/to/geant4-install/bin
source geant4.sh
```

### Compile from source
1. Create a build directory adjacent to the source directory and navigate to it
```bash
cd /path/to/VictreAndDetector
cd ..
mkdir /path/to/VictreAndDetector-build
cd /path/to/VictreAndDetector-build
```
2. Run CMake, specifying your Geant4 install directory
```bash
cmake -DGEANT4_DIR=/path/to/geant4-install/lib/Geant4-10.7.0 /path/to/VictreAndDetector
```
3. Build the project
```bash
make
```

All necessary `.mac`, `.txt`, and the `ExampleVictrePhantom/` directory will be copied into your build directory automatically.

---

## Running the executable
1. Make sure you set environment variables as above
2. To run interactively, using the provided example VICTRE config file, from the build directory run:
```bash
./VictreAndDetector VICTRE_config_120.txt
```
3. To run using the provided macro file:
```bash
./VictreAndDetector VICTRE_config_120.txt run_120.mac
```
- The example macro uses a spectrum generated by SpekPy
- Events will keep being generated until **n_target_detector_events** have hit the detector. **Be careful** when playing with the beam geometry in the macro file, if you point the source away from the detector, events will be generated indefinitely as **n_target_detector_events** will never be reached
- The `ExampleVictrePhantom/` directory contains the provided example VICTRE breast phantom, which has been compressed and cropped, as per Chapter 7 of my thesis

---

## Visualisation
- When running in interactive mode, the scene will be loaded and displayed (if you installed the OpenGL drivers with Geant4). I have done no optimisation for the visualisation, so it is very slow. Allow a couple of minutes for the scene to load

## Output
- This project will output a `.csv` file: `{PhantomFolder}_nt_EdepTable.csv`
- The first 9 rows of the file can be discarded
- Data format:
  - **Column 1**: (int) EventID  
  - **Column 2**: (double) Deposition position X (mm)  
  - **Column 3**: (double) Deposition position Y (mm)  
  - **Column 4**: (double) Deposition position Z (mm)  
  - **Column 5**: (double) Deposition energy (keV)  
